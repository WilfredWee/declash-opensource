"use strict";var declashControllers=angular.module("declashControllers",[]);declashControllers.controller("AppController",["$scope","$rootScope","$location","GlobalService",function(e,t,n,o){t.globals=o,e.initialize=function(e){t.globals.is_authenticated="False"==e?!1:!0}}]),declashControllers.controller("SessionListCtrl",["$scope","$interval","Restangular","$modal",function(e,t,n,o){var s=function(){n.all("sessions").getList().then(function(t){e.sessions=t,e.$$phase||e.$apply()})};s(),e.openForm=function(e){var t=o.open({templateUrl:"sessionreg2.html",controller:"DebaterRegCtrl",resolve:{sessionObj:function(){return e}}});t.result.then(function(){s()})}}]),declashControllers.controller("DebaterRegCtrl",["$scope","$modalInstance","Restangular","sessionObj",function(e,t,n,o){e.session=o,e.errorMessage="",e.debatername="",e.teammate={},e.teammate2={},e.viableTeammates=[],e.novpro="NOV",e.djs="DEBATE",e.positionpref="OP",e.customrequest="";for(var s=0;s<o.debaters.length;s++)o.debaters[s].teammates.length<1&&null==o.debaters[s].team&&e.viableTeammates.push(o.debaters[s]);e.Submit=function(){var o=function(){return e.teammate.id?e.teammate2.id?[e.teammate.id,e.teammate2.id]:[e.teammate.id]:[]},s={name:this.debatername,teammates:o(),team:null,nov_pro:this.novpro,debate_judge_spectate:this.djs,session:e.session.id,position:this.positionpref,custom_requests:this.customrequest};n.all("debaters/").post(s).then(function(){t.close()},function(t){e.errorMessage=t.data})},e.Cancel=function(){t.dismiss("cancel")},e.addTeammate=function(t,n){0==n?e.teammate=t:e.teammate2=t},e.teammateFilter=function(t){return t!=e.teammate}}]),declashControllers.controller("ManagementCtrl",["$scope","$route","Restangular","$modal",function(e,t,n,o){e.isCollapsed=!1;var s=function(t){if(t.data instanceof Array)for(var n=0,o=t.data.length;o>n;n++)e.alerts.push(t.data[n]);else e.alerts.push(t.data)},a=function(){n.all("rooms").getList().then(function(t){e.rooms=t,e.$$phase||e.$apply()})},r=function(){n.all("sessions").getList().then(function(t){e.alerts=[],e.session=t[0],e.tableDebaters=i(t[0]),e.tableTeams=l(t[0],t[0].debaters)},function(e){s(e)})},i=function(e){for(var t=[],n=JSON.parse(JSON.stringify(e.debaters)),o=0;o<n.length;o++){var s=n[o].teammates.length;if(1>s)t.push(n[o]);else{var a=_.remove(n,function(e){for(var t=0;s>t;t++)if(e.id===n[o].teammates[t])return!0;return!1});n[o].teammates=a,t.push(n[o])}}return t},l=function(t,n){for(var o=t.teams,s=n,a=0,r=o.length;r>a;a++){for(var i=0,l=o[a].team_members.length;l>i;i++)o[a].team_members[i]=_.find(s,function(e){return e.id==o[a].team_members[i]});o[a].room=_.find(e.rooms,function(e){return e.id==o[a].room})}return o};a(),r(),e.createSession=function(){var t=o.open({templateUrl:"sessioncreate.html",controller:"SessionCreateCtrl"});t.result.then(function(t){e.session=t})},e.toggleReg=function(t){var o=n.copy(e.session);o.patch({openForReg:t}).then(function(t){e.session.openForReg=t.openForReg},function(e){s(e)})},e.deClashify=function(){console.log("boom"),n.one("sessions",e.session.id).get({declashify:!0}).then(function(){r(),a()},function(e){s(e),console.log(e)})},e.togglePublish=function(t){var o=n.copy(e.session);o.patch({published:t}).then(function(t){e.session.published=t.published},function(e){s(e),console.log("response data"+e.data)})},e.teamNullDebaters=function(e){return null==e.team},e.addRoom=function(t){t.location.length<1||(t.group||(t.group=0),n.all("rooms/").post(t).then(function(t){e.rooms.push(t)},function(e){s(e),console.log(e.data)}))},e.deleteRoom=function(t){n.one("rooms",t.id).remove().then(function(){e.rooms=_.reject(e.rooms,function(e){return e==t}),r()},function(e){s(e),console.log(reponse.data)})},e.createTeam=function(){var t=o.open({templateUrl:"teamcreate.html",controller:"TeamCreateCtrl",resolve:{session:function(){return r(),e.session},rooms:function(){return e.rooms}}});t.result.then(function(){r()})},e.deleteDebater=function(e){n.one("debaters",e.id).remove().then(function(){r()},function(e){s(e)})},e.patchDebater=function(e,t,o){var a={};a[t]=o,n.one("debaters",e.id).patch(a).then(function(){r()},function(e){s(e),console.log(e)})},e.deleteTeam=function(e){n.one("teams",e.id).remove().then(function(){r()})},e.finalize=function(){var t=o.open({templateUrl:"finalize.html",controller:"FinalizeCtrl",resolve:{sessionID:function(){return r(),e.session.id}}});t.result.then(function(){r()})},e.createDiffStyleForMessage=function(e){return e&&e.custom_requests?{color:"red"}:{color:"black"}}}]),declashControllers.controller("SessionCreateCtrl",["$scope","$modalInstance","Restangular",function(e,t,n){e.master={},e.submit=function(o){e.master=angular.copy(o),e.master.openForReg=!0,n.all("sessions/").post(e.master).then(function(e){n.one("sessions",e.id).get().then(function(e){t.close(e)})},function(){})},e.cancel=function(){t.dismiss("cancel")}}]),declashControllers.controller("TeamCreateCtrl",["$scope","$modalInstance","Restangular","session","rooms",function(e,t,n,o,s){e.errorMessage="",e.session=o,e.rooms=s,e.teamDebaters=[],e.team={},e.team.position="GV",e.team.room=null,e.nullTeamFilter=function(t){var n=null==t.team&&!_.contains(e.teamDebaters,t),o="JUDGE"!=t.debate_judge_spectate&&"SPEC"!=t.debate_judge_spectate;return n&&o},e.notInUsedRoom=function(e){var t=_.reduce(o.teams,function(t,n){return n.room.id==e.id&&t++,t},0);return"BP"==o.format?4>t?!0:!1:2>t?!0:!1},e.addDebater=function(t,n){e.teamDebaters[n]=t},e.submit=function(o){e.master={},e.master.session=e.session.id,e.master.team_members=_.map(e.teamDebaters,function(e){return e.id}),e.master.room=o.room.id,e.master.position=o.position,n.all("teams/").post(e.master).then(function(e){t.close(e)},function(t){e.errorMessage=t.data,console.log(e.master)})},e.cancel=function(){t.dismiss("cancel")}}]),declashControllers.controller("TeamsCtrl",["$scope","$routeParams","Restangular",function(e,t,n){n.all("teams").getList({sessionID:t.sessionID}).then(function(n){e.teams=n.filter(function(e){return e.session==t.sessionID})})}]),declashControllers.controller("FinalizeCtrl",["$scope","$modalInstance","Restangular","sessionID",function(e,t,n,o){e.confirm=function(){n.one("sessions",o).patch({finalized:!0}).then(function(){t.close()})},e.cancel=function(){t.dismiss("cancel")}}]);
